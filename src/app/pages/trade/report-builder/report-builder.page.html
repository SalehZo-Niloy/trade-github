<app-trade-layout
  organisationName="Trade Finance"
  solutionName="Trade Finance"
  breadcrumb="Report Builder"
  basePath="/trade"
>
  <div class="p-6 bg-white min-h-screen space-y-4">
    <!-- Use utility classes for consistent sizing to avoid fragile selectors -->
    <div class="flex items-center justify-between">
      <div class="flex gap-3">
        <app-ui-button variant="secondary"> Import </app-ui-button>
        <app-ui-button variant="ghost"> Open in queries </app-ui-button>
      </div>
      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2">
          <span
            class="flex h-10 w-10 items-center justify-center rounded-md bg-slate-50 border border-slate-200 text-slate-600"
          >
            <!-- modern SQL/database stacked icon -->
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              class="text-slate-600"
            >
              <path
                d="M12 3C7.03 3 3 4.79 3 7v10c0 2.21 4.03 4 9 4s9-1.79 9-4V7c0-2.21-4.03-4-9-4z"
                stroke="currentColor"
                stroke-width="1.2"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
              />
              <path
                d="M3 7c0 2.21 4.03 4 9 4s9-1.79 9-4"
                stroke="currentColor"
                stroke-width="1.2"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
              />
              <path
                d="M3 11c0 2.21 4.03 4 9 4s9-1.79 9-4"
                stroke="currentColor"
                stroke-width="1.2"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
              />
            </svg>
          </span>
          <app-ui-dropdown
            class="h-10 -mt-3 w-64"
            [placeholder]="'Template SQL'"
            [options]="templateOptions"
            [value]="selectedTemplate"
            (valueChange)="applyTemplate($event)"
          >
          </app-ui-dropdown>
        </div>
        <app-ui-button variant="primary" (click)="toggleExportOptions()"> Export </app-ui-button>
      </div>
    </div>

    <div class="rounded-md border border-slate-200 bg-slate-50">
      <textarea
        [(ngModel)]="query"
        class="block w-full bg-transparent px-4 py-3 font-mono text-sm leading-relaxed text-slate-800 outline-none border-0 min-h-[260px] resize-none"
        spellcheck="false"
      ></textarea>
    </div>

    <div class="flex items-start justify-between">
      <div class="flex gap-3">
        <app-ui-button variant="primary" (click)="runQuery()"> Run </app-ui-button>
        <app-ui-button variant="secondary" (click)="formatQuery()"> Format </app-ui-button>
      </div>
      <div class="text-xs text-slate-500 space-y-0.5">
        <div>Key bindings:</div>
        <div>Shift + Enter : Run</div>
        <div>Alt + Shift + F or Ctrl + Shift + F : Format</div>
        <div>Alt + R : Apply focus to first result</div>
      </div>
    </div>

    <div
      *ngIf="previewText && !showHtmlPreview"
      class="mt-4 rounded-md border border-slate-200 bg-slate-50 p-4"
    >
      <div class="mb-2 text-xs font-semibold uppercase tracking-wide text-slate-500">Preview</div>
      <pre
        class="whitespace-pre-wrap font-mono text-xs text-slate-800"
        [textContent]="previewText"
      ></pre>
    </div>

    <div *ngIf="showHtmlPreview" class="mt-4">
      <!-- LC Worklist Table with Full Borders (Rows + Columns) -->
      <div class="lc-container">
        <h2>LC Worklist</h2>

        <table class="lc-table-bordered">
          <thead>
            <tr>
              <th>LC Reference</th>
              <th>Date</th>
              <th>Customer</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Beneficiary</th>
              <th>Status</th>
              <th>Assigned To</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>LC-2024-001</td>
              <td>2024-01-12</td>
              <td>ABC Trading Ltd</td>
              <td>Sight</td>
              <td>$150,000</td>
              <td>XYZ Exports Inc</td>
              <td>Pending Validation</td>
              <td>John Smith</td>
            </tr>

            <tr>
              <td>LC-2024-002</td>
              <td>2024-01-11</td>
              <td>Global Industries</td>
              <td>Usance</td>
              <td>€85,000</td>
              <td>European Suppliers</td>
              <td>Forwarded to Trade</td>
              <td>Sarah Johnson</td>
            </tr>

            <tr>
              <td>LC-2024-003</td>
              <td>2024-01-10</td>
              <td>Tech Solutions Corp</td>
              <td>Sight</td>
              <td>$75,500</td>
              <td>Asia Manufacturing</td>
              <td>Initiated</td>
              <td>Mike Chen</td>
            </tr>

            <tr>
              <td>LC-2024-004</td>
              <td>2024-01-09</td>
              <td>Retail Chain Ltd</td>
              <td>Usance</td>
              <td>£120,000</td>
              <td>UK Distributors</td>
              <td>Pending Validation</td>
              <td>Emma Davis</td>
            </tr>

            <tr>
              <td>LC-2024-005</td>
              <td>2024-01-15</td>
              <td>Horizon Textiles Ltd</td>
              <td>Sight</td>
              <td>$220,000</td>
              <td>Pacific Garments Co.</td>
              <td>Pending Validation</td>
              <td>Daniel Wright</td>
            </tr>

            <tr>
              <td>LC-2024-006</td>
              <td>2024-01-14</td>
              <td>Nova Pharmaceuticals</td>
              <td>Usance</td>
              <td>€140,500</td>
              <td>EuroMed Supplies GmbH</td>
              <td>Forwarded to Trade</td>
              <td>Alicia Brown</td>
            </tr>

            <tr>
              <td>LC-2024-007</td>
              <td>2024-01-13</td>
              <td>GreenField Agro Corp</td>
              <td>Sight</td>
              <td>$98,750</td>
              <td>Asia Agro Exports</td>
              <td>Initiated</td>
              <td>Kevin Liu</td>
            </tr>

            <tr>
              <td>LC-2024-008</td>
              <td>2024-01-12</td>
              <td>Metro Electronics Ltd</td>
              <td>Usance</td>
              <td>£310,000</td>
              <td>UK Components PLC</td>
              <td>Pending Validation</td>
              <td>Olivia Turner</td>
            </tr>

            <tr>
              <td>LC-2024-009</td>
              <td>2024-01-11</td>
              <td>BlueWave Shipping Co.</td>
              <td>Sight</td>
              <td>$450,000</td>
              <td>Nordic Marine Systems</td>
              <td>Forwarded to Trade</td>
              <td>Michael Anderson</td>
            </tr>

            <tr>
              <td>LC-2024-010</td>
              <td>2024-01-10</td>
              <td>Sunrise Construction Ltd</td>
              <td>Usance</td>
              <td>€275,000</td>
              <td>BuildTech Europe SA</td>
              <td>Initiated</td>
              <td>Sophia Martinez</td>
            </tr>
          </tbody>
        </table>
      </div>

      <style>
        body {
          font-family: Arial, sans-serif;
        }

        .lc-container {
          width: 100%;
          margin: 20px auto;
        }

        h2 {
          margin-bottom: 12px;
          color: #222;
        }

        /* Full bordered table */
        .lc-table-bordered {
          width: 100%;
          border-collapse: collapse;
          border: 2px solid #000;
          font-size: 14px;
        }

        /* Borders for rows + columns */
        .lc-table-bordered th,
        .lc-table-bordered td {
          border: 1px solid #000;
          padding: 10px;
          text-align: left;
        }

        /* Header styling */
        .lc-table-bordered th {
          background-color: oklch(93.2% 0.032 255.585);
          font-weight: bold;
          text-align: center;
        }

        /* Row hover */
        .lc-table-bordered tbody tr:hover {
          background-color: #e8f4ff;
        }

        /* Amount alignment */
        .lc-table-bordered td:nth-child(5) {
          text-align: right;
          font-weight: bold;
        }
      </style>

      <style>
        :root {
          --border: #e5e7eb;
          --text: #111827;
          --muted: #6b7280;
          --bg: #ffffff;
          --header: #f9fafb;
          --shadow: 0 6px 18px rgba(17, 24, 39, 0.08);
          --radius: 14px;
          --pill-ok-bg: #ecfdf5;
          --pill-ok-tx: #065f46;
          --pill-info-bg: #eff6ff;
          --pill-info-tx: #1d4ed8;
          --pill-warn-bg: #fffbeb;
          --pill-warn-tx: #92400e;
        }
        .lc-card {
          background: var(--bg);
          border: 1px solid var(--border);
          border-radius: var(--radius);
          box-shadow: var(--shadow);
          overflow: hidden;
          font-family:
            system-ui,
            -apple-system,
            Segoe UI,
            Roboto,
            Arial,
            sans-serif;
          color: var(--text);
        }
        .lc-header {
          padding: 16px 18px;
          border-bottom: 1px solid var(--border);
          background: var(--header);
        }
        .lc-header h2 {
          margin: 0 0 4px 0;
          font-size: 18px;
          line-height: 1.2;
        }
        .lc-header p {
          margin: 0;
          font-size: 13px;
          color: var(--muted);
        }
        .lc-table-wrap {
          overflow: auto;
          max-width: 100%;
        }
        .lc-table {
          width: 100%;
          border-collapse: separate;
          border-spacing: 0;
          min-width: 980px;
        }
        .lc-table thead th {
          position: sticky;
          top: 0;
          background: var(--header);
          z-index: 1;
          text-align: left;
          font-size: 12px;
          letter-spacing: 0.02em;
          color: #374151;
          padding: 12px 12px;
          border-bottom: 1px solid var(--border);
          white-space: nowrap;
        }
        .lc-table tbody td {
          padding: 12px 12px;
          border-bottom: 1px solid var(--border);
          font-size: 13px;
          vertical-align: middle;
          white-space: nowrap;
        }
        .lc-table tbody tr:hover {
          background: #fafafa;
        }
        .num {
          text-align: right;
          font-variant-numeric: tabular-nums;
        }
        .pill {
          display: inline-flex;
          align-items: center;
          padding: 4px 10px;
          border-radius: 999px;
          font-size: 12px;
          font-weight: 600;
          border: 1px solid transparent;
        }
        .pill-ok {
          background: var(--pill-ok-bg);
          color: var(--pill-ok-tx);
          border-color: rgba(6, 95, 70, 0.15);
        }
        .pill-info {
          background: var(--pill-info-bg);
          color: var(--pill-info-tx);
          border-color: rgba(29, 78, 216, 0.15);
        }
        .pill-warn {
          background: var(--pill-warn-bg);
          color: var(--pill-warn-tx);
          border-color: rgba(146, 64, 14, 0.15);
        }
        @media (max-width: 640px) {
          .lc-header {
            padding: 14px;
          }
          .lc-table {
            min-width: 920px;
          }
        }
      </style>
    </div>
  </div>

  <div
    *ngIf="showExportOptions"
    class="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40"
  >
    <div class="w-full max-w-md rounded-lg bg-white shadow-lg border border-slate-200">
      <div class="flex items-center justify-between border-b border-slate-200 px-5 py-3">
        <div class="text-sm font-semibold text-slate-900">Export Report</div>
        <button
          type="button"
          class="inline-flex h-7 w-7 items-center justify-center rounded-md text-slate-500 hover:bg-slate-100 hover:text-slate-700"
          (click)="toggleExportOptions()"
        >
          ✕
        </button>
      </div>
      <div class="px-5 py-4 space-y-3 text-sm text-slate-700">
        <p class="text-xs text-slate-500">
          Choose a format to download or view the LC static report.
        </p>
        <a
          href="/assets/pdf/LC_Static_Report.pdf"
          target="_blank"
          download
          class="flex items-center justify-between rounded-md border border-slate-200 px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50"
          (click)="toggleExportOptions()"
        >
          <span>PDF</span>
          <span class="text-[11px] text-slate-400">View in new tab or download</span>
        </a>
        <a
          href="/assets/pdf/LC_Static_Report.xlsx"
          target="_blank"
          download
          class="flex items-center justify-between rounded-md border border-slate-200 px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50"
          (click)="toggleExportOptions()"
        >
          <span>Excel (.xlsx)</span>
          <span class="text-[11px] text-slate-400">Open/download in new tab</span>
        </a>
      </div>
      <div class="flex justify-end border-t border-slate-200 px-5 py-3">
        <button
          type="button"
          class="inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50"
          (click)="toggleExportOptions()"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</app-trade-layout>
