<app-trade-layout
  organisationName="Trade Platform"
  solutionName="Trade Finance"
  breadcrumb="Master LC / Create Request"
  basePath="/trade"
>
  <div class="mx-auto max-w-5xl">
    <!-- Stepper -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <ng-container *ngFor="let step of steps; let i = index; let last = last">
          <div class="flex flex-col items-center relative z-10" [class.flex-1]="!last">
            <button 
              (click)="goToStep(step.number)"
              [disabled]="step.number > currentStep"
              class="flex h-8 w-8 items-center justify-center rounded-full text-xs font-semibold transition-colors duration-200"
              [ngClass]="{
                'bg-blue-600 text-white': step.number <= currentStep,
                'bg-gray-200 text-gray-500': step.number > currentStep
              }"
            >
              <span *ngIf="step.number >= currentStep">{{ step.number }}</span>
              <svg *ngIf="step.number < currentStep" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
              </svg>
            </button>
            <span 
              class="absolute top-10 text-xs font-medium whitespace-nowrap"
              [ngClass]="{
                'text-blue-600': step.number <= currentStep,
                'text-gray-500': step.number > currentStep
              }"
            >
              {{ step.name }}
            </span>
          </div>
          <div *ngIf="!last" class="flex-1 h-0.5 bg-gray-200 relative -top-3 -mx-4">
            <div 
              class="h-full bg-blue-600 transition-all duration-300"
              [style.width.%]="currentStep > step.number ? 100 : 0"
            ></div>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Step Content -->
    <div class="mt-12 rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      
      <!-- Step 1: Link LC -->
      <div *ngIf="currentStep === 1">
        <h2 class="text-lg font-semibold text-slate-900 mb-6">Step 1: Link Export LC Details</h2>
        
        <div *ngIf="selectedLC" class="mb-6 rounded-md bg-blue-50 p-4 border border-blue-100">
          <div class="flex items-center gap-2 text-blue-700">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" />
            </svg>
            <span class="font-medium">Linked Export LC: {{ selectedLC.no }}</span>
          </div>
          <p class="mt-1 ml-7 text-xs text-blue-600">Values are auto-populated from the selected Export LC.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-xs font-medium text-slate-500 uppercase">Export LC No</label>
            <div class="mt-1 block w-full rounded-md border-gray-200 bg-gray-50 px-3 py-2 text-sm text-slate-700">
              {{ data.exportLCNo || 'Not Selected' }}
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-500 uppercase">Export LC Amount</label>
            <div class="mt-1 block w-full rounded-md border-gray-200 bg-gray-50 px-3 py-2 text-sm text-slate-700">
              {{ selectedLC?.currency }} {{ selectedLC?.amount | number:'1.2-2' }}
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-500 uppercase">Expiry Date</label>
            <div class="mt-1 block w-full rounded-md border-gray-200 bg-gray-50 px-3 py-2 text-sm text-slate-700">
              {{ selectedLC?.expiryDate }}
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-500 uppercase">Latest Shipment Date</label>
            <div class="mt-1 block w-full rounded-md border-gray-200 bg-gray-50 px-3 py-2 text-sm text-slate-700">
              {{ selectedLC?.latestShipmentDate }}
            </div>
          </div>
          <div class="md:col-span-2">
            <label class="block text-xs font-medium text-slate-500 uppercase">Beneficiary (Exporter)</label>
            <div class="mt-1 block w-full rounded-md border-gray-200 bg-gray-50 px-3 py-2 text-sm text-slate-700">
              {{ selectedLC?.beneficiary }}
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: Parties -->
      <div *ngIf="currentStep === 2">
        <h2 class="text-lg font-semibold text-slate-900 mb-6">Step 2: Applicant & Supplier Information</h2>
        
        <div class="space-y-6">
          <div>
            <label class="block text-xs font-medium text-slate-500 uppercase mb-1">Applicant Name (Exporter)</label>
            <input type="text" [(ngModel)]="data.applicantName" class="block w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:ring-blue-500" readonly>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-xs font-medium text-slate-500 uppercase mb-1">Supplier Type</label>
              <select [(ngModel)]="data.supplierType" class="block w-full rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3">
                <option value="Local">Local</option>
                <option value="Foreign">Foreign</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-500 uppercase mb-1">Supplier Name <span class="text-red-500">*</span></label>
              <input type="text" [(ngModel)]="data.supplierName" placeholder="Enter Supplier Name" class="block w-full rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3">
            </div>
          </div>

          <div>
            <label class="block text-xs font-medium text-slate-500 uppercase mb-1">Supplier Address</label>
            <textarea [(ngModel)]="data.supplierAddress" rows="3" placeholder="Enter full address" class="block w-full rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3"></textarea>
          </div>
        </div>
      </div>

      <!-- Step 3: PI & Goods -->
      <div *ngIf="currentStep === 3">
        <h2 class="text-lg font-semibold text-slate-900 mb-6">Step 3: Proforma Invoice & Goods</h2>
        
        <div class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <label class="block text-xs font-medium text-slate-500 uppercase mb-1">PI Number</label>
              <input type="text" [(ngModel)]="data.piNumber" class="block w-full rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3">
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-500 uppercase mb-1">PI Date</label>
              <input type="date" [(ngModel)]="data.piDate" class="block w-full rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3">
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-500 uppercase mb-1">HS Code</label>
              <input type="text" [(ngModel)]="data.hsCode" class="block w-full rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3">
            </div>
          </div>

          <div>
            <label class="block text-xs font-medium text-slate-500 uppercase mb-1">Goods Description</label>
            <textarea [(ngModel)]="data.goodsDescription" rows="4" class="block w-full rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3"></textarea>
          </div>

          <div class="flex gap-6 pt-2">
            <div class="flex items-center">
              <input id="partial" type="checkbox" [(ngModel)]="data.partialShipmentAllowed" class="h-4 w-4 rounded border border-gray-300 text-blue-600 focus:ring-blue-500">
              <label for="partial" class="ml-2 block text-sm font-medium text-slate-700">Partial Shipment Allowed</label>
            </div>
            <div class="flex items-center">
              <input id="trans" type="checkbox" [(ngModel)]="data.transshipmentAllowed" class="h-4 w-4 rounded border border-gray-300 text-blue-600 focus:ring-blue-500">
              <label for="trans" class="ml-2 block text-sm font-medium text-slate-700">Transshipment Allowed</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 4: Limits & Charges -->
      <div *ngIf="currentStep === 4">
        <h2 class="text-lg font-semibold text-slate-900 mb-6">Step 4: Limit & Charges</h2>

        <div class="bg-slate-800 rounded-lg p-6 text-white mb-8">
            <h3 class="text-sm font-semibold uppercase tracking-wide text-slate-400 mb-4">BTB LC Limit Summary</h3>
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <p class="text-xs text-slate-400">Approved Limit</p>
                    <p class="text-xl font-bold">$1,000,000.00</p>
                </div>
                <div>
                    <p class="text-xs text-slate-400">Utilized</p>
                    <p class="text-xl font-bold text-yellow-400">$450,000.00</p>
                </div>
                <div>
                    <p class="text-xs text-slate-400">Available</p>
                    <p class="text-xl font-bold text-green-400">$550,000.00</p>
                </div>
            </div>
        </div>

        <div class="space-y-6">
            <div>
                <label class="block text-xs font-medium text-slate-500 uppercase mb-1">Requested Master LC Amount</label>
                <div class="flex gap-2">
                    <select [(ngModel)]="data.currency" class="w-24 rounded-md border border-gray-300 bg-gray-50 text-gray-900 font-semibold shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3">
                        <option value="" disabled selected>CCY</option>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                    </select>
                    <input type="number" [(ngModel)]="data.requestedAmount" class="flex-1 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3" placeholder="Enter amount">
                </div>
                <p class="mt-1 text-xs text-slate-500">Max allowed: 70% of Export LC</p>
            </div>
        </div>
      </div>

      <!-- Step 5: Documents -->
      <div *ngIf="currentStep === 5">
        <h2 class="text-lg font-semibold text-slate-900 mb-6">Step 5: Documents Checklist</h2>

        <div class="space-y-4">
            <div *ngFor="let doc of documentList" class="flex items-center justify-between p-4 border border-slate-200 rounded-lg hover:bg-slate-50">
                <div class="flex items-center gap-3">
                    <div class="h-10 w-10 flex items-center justify-center rounded-full" [ngClass]="isUploaded(doc.name) ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-400'">
                        <svg *ngIf="isUploaded(doc.name)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                        </svg>
                        <svg *ngIf="!isUploaded(doc.name)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-slate-900">{{ doc.name }} <span *ngIf="doc.required" class="text-red-500">*</span></p>
                        <p *ngIf="isUploaded(doc.name)" class="text-xs text-green-600">Uploaded</p>
                    </div>
                </div>
                <button (click)="mockUpload(doc.name)" class="px-3 py-1.5 text-xs font-medium rounded-md border transition-colors"
                [ngClass]="isUploaded(doc.name) ? 'border-red-200 text-red-600 hover:bg-red-50' : 'border-blue-200 text-blue-600 hover:bg-blue-50'">
                    {{ isUploaded(doc.name) ? 'Remove' : 'Mock Upload' }}
                </button>
            </div>
        </div>
      </div>

      <!-- Step 6: Review -->
      <div *ngIf="currentStep === 6">
        <h2 class="text-lg font-semibold text-slate-900 mb-6">Step 6: Review Application</h2>
        
        <div class="space-y-8">
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h3 class="text-sm font-semibold text-gray-900 mb-3 uppercase tracking-wide">Export LC & Parties</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-gray-500">Export LC No</p>
                        <p class="font-medium">{{ data.exportLCNo }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">Supplier Name</p>
                        <p class="font-medium">{{ data.supplierName }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">Applicant</p>
                        <p class="font-medium">{{ data.applicantName }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h3 class="text-sm font-semibold text-gray-900 mb-3 uppercase tracking-wide">Goods & Amount</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-gray-500">PI Number</p>
                        <p class="font-medium">{{ data.piNumber }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">PI Date</p>
                        <p class="font-medium">{{ data.piDate }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">Requested Amount</p>
                        <p class="font-medium">{{ data.currency }} {{ data.requestedAmount | number:'1.2-2' }}</p>
                    </div>
                     <div>
                        <p class="text-gray-500">HS Code</p>
                        <p class="font-medium">{{ data.hsCode }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h3 class="text-sm font-semibold text-gray-900 mb-3 uppercase tracking-wide">Documents</h3>
                <ul class="list-disc list-inside text-sm text-gray-700">
                    <li *ngFor="let doc of data.documents">{{ doc.name }}</li>
                </ul>
            </div>
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="mt-8 flex items-center justify-between border-t border-slate-100 pt-6">
        <button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
          </svg>
          Save Draft
        </button>

        <div class="flex items-center gap-3">
          <button 
            *ngIf="currentStep > 1"
            (click)="prevStep()"
            class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 rounded-md border border-slate-300"
          >
            Back
          </button>
          
          <button 
            *ngIf="currentStep < 6"
            (click)="nextStep()"
            class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md shadow-sm"
          >
            Next Step
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
          </button>

          <button 
            *ngIf="currentStep === 6"
            (click)="submit()"
            class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md shadow-sm"
          >
            Submit Application
          </button>
        </div>
      </div>
    </div>
  </div>
</app-trade-layout>
