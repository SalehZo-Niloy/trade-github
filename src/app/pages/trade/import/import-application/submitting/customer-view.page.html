<app-trade-layout
  organisationName="Trade Platform"
  solutionName="Trade Finance"
  breadcrumb="Import LC Initiation ‚Äì Request Status"
  basePath="/trade"
>
  <section class="rounded-2xl border border-slate-200 bg-white px-6 py-4 shadow-sm">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="flex h-9 w-9 items-center justify-center rounded-full bg-blue-50 text-blue-600">
          üìò
        </div>
        <div class="space-y-1">
          <h1 class="text-sm font-semibold text-slate-900">
            Import LC Request Status
          </h1>
          <p class="text-xs text-slate-500">
            Track your Letter of Credit application progress.
          </p>
          <p class="text-[11px] text-slate-500">
            LC Reference:
            <span class="font-medium text-slate-900">{{ referenceNumber }}</span>
          </p>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-3 md:justify-end">
        <div
          class="inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-medium text-emerald-700"
          aria-live="polite"
        >
          <span class="mr-1 h-1.5 w-1.5 rounded-full bg-emerald-500"></span>
          {{ currentStatus }}
        </div>
        <div class="text-[11px] text-slate-500">
          Last updated:
          <span class="font-medium text-slate-900">{{ requestDateTime }}</span>
        </div>
        <div class="flex items-center gap-2">
          <app-ui-button
            variant="secondary"
            class="transition-all duration-150 ease-out hover:-translate-y-0.5"
            (click)="print()"
          >
            Print Status
          </app-ui-button>
          <app-ui-button
            variant="primary"
            class="transition-all duration-150 ease-out hover:-translate-y-0.5"
            (click)="goBackToSubmitting()"
          >
            Back to LC List
          </app-ui-button>
        </div>
      </div>
    </div>
  </section>

  <section
    class="mt-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
    aria-label="Request progress timeline"
  >
    <div class="flex items-center justify-between gap-4">
      <div class="space-y-1">
        <h2 class="text-sm font-semibold text-slate-900">Request Progress Timeline</h2>
        <p class="text-xs text-slate-500">
          Follow the end-to-end status of your Import LC request.
        </p>
      </div>
      <p class="hidden text-[11px] text-slate-500 md:block">
        Submitted by
        <span class="font-medium text-slate-900">{{ submittedBy || 'Customer' }}</span>
      </p>
    </div>
    <app-ui-step-timeline
      class="mt-6"
      [steps]="timelineSteps"
      [currentStepIndex]="currentStepIndex"
    ></app-ui-step-timeline>
    <p class="mt-3 text-xs text-slate-500">
      {{ currentStatusDescription }}
    </p>
  </section>

  <section
    class="mt-4 space-y-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
    aria-label="Draft Letter of Credit preview"
  >
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="space-y-1">
        <h2 class="text-sm font-semibold text-slate-900">Draft Letter of Credit (Preview)</h2>
        <p class="text-xs text-slate-500">
          This draft LC will be issued based on your request and bank approval.
        </p>
      </div>
      <div
        class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-[11px] font-medium text-slate-700"
      >
        Draft ‚Äì Pending Issuance
      </div>
    </div>

      <div
        class="mt-4 flex flex-col gap-3 rounded-xl border border-dashed border-slate-200 bg-slate-50 px-4 py-3 text-xs text-slate-700 md:flex-row md:items-center md:justify-between"
        aria-label="Draft LC actions"
      >
      <div class="flex items-start gap-3">
        <div
          class="mt-1 flex h-7 w-7 items-center justify-center rounded-full bg-blue-100 text-blue-700"
          aria-hidden="true"
        >
          ‚Ñπ
        </div>
        <div>
          <div class="font-semibold text-slate-900">
            Draft LC will be available after bank verification is completed.
          </div>
          <p class="mt-1 text-[11px] text-slate-600">
            You will receive a notification once the draft LC is ready for review and download.
          </p>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-2 md:justify-end">
        <app-ui-button
          variant="primary"
          class="min-w-[180px] justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
          (click)="viewFile()"
          aria-label="View draft LC PDF"
          [disabled]="draftLoading || !isAuthorizedForDraft"
        >
          View Draft LC (PDF)
        </app-ui-button>
        <app-ui-button
          variant="secondary"
          class="min-w-[150px] justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
          (click)="downloadFile()"
          aria-label="Download draft LC PDF"
          [disabled]="draftLoading || !isAuthorizedForDraft"
        >
          Download Draft LC
        </app-ui-button>
        <app-ui-button
          variant="secondary"
          class="min-w-[140px] justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
          (click)="printDraft()"
          aria-label="Print draft LC PDF"
          [disabled]="draftLoading || !isAuthorizedForDraft"
        >
          Print Draft LC
        </app-ui-button>
      </div>
      <div class="mt-2 flex flex-col gap-1 text-[11px] md:items-end">
        <div
          *ngIf="draftLoading"
          class="text-slate-500"
          aria-live="polite"
        >
          Loading draft LC PDF‚Ä¶
        </div>
        <div
          *ngIf="draftError"
          class="text-rose-600"
          aria-live="assertive"
        >
          {{ draftError }}
        </div>
      </div>
    </div>
  </section>

  <section
    *ngIf="showDraftModal"
    class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 p-4"
    aria-modal="true"
    role="dialog"
    aria-label="Draft LC PDF preview"
  >
    <div
      class="flex w-full flex-col overflow-hidden rounded-2xl bg-white shadow-xl"
      style="height: 90vh; min-height: 600px; max-width: 1200px;"
    >
      <div class="flex items-center justify-between border-b border-slate-200 px-4 py-3">
        <h3 class="text-sm font-semibold text-slate-900">
          Draft Letter of Credit (PDF)
        </h3>
        <button
          type="button"
          class="rounded-full border border-slate-200 px-2 py-1 text-xs font-medium text-slate-600 hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-white"
          (click)="closeDraftModal()"
        >
          Close
        </button>
      </div>
      <div class="flex-1 bg-slate-100 overflow-hidden">
        <ng2-pdfjs-viewer
          [pdfSrc]="draftPdfPath"
          [showSpinner]="true"
          [showSidebar]="true"
          [showToolbarLeft]="true"
          [showToolbarMiddle]="true"
          [showToolbarRight]="true"
          [useOnlyCssZoom]="false"
          style="display: block; width: 100%; height: 100%;"
        ></ng2-pdfjs-viewer>
      </div>
    </div>
  </section>

  <section
    class="mt-4 grid gap-4 md:grid-cols-3"
    aria-label="LC details and submitted trade summary"
  >
    <div
      class="md:col-span-2 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
      aria-label="Bank-verified LC details"
    >
      <div class="mb-4 flex items-center justify-between gap-2">
        <h2 class="text-sm font-semibold text-slate-900">Bank-Verified LC Details</h2>
        <button
          type="button"
          class="text-xs font-medium text-blue-700 transition-colors hover:text-blue-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-white"
          (click)="viewSubmittedDetails()"
        >
          View Change Summary
        </button>
      </div>

      <div
        *ngIf="hasSummaryData; else emptySummary"
        class="grid gap-6 md:grid-cols-2"
      >
        <div class="space-y-4">
          <div>
            <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
              LC Identification
            </div>
            <div class="mt-1 text-sm font-semibold text-slate-900">
              {{ summary.typeOfLc || 'Not specified' }}
            </div>
            <div class="mt-1 text-xs text-slate-500">
              Reference
              <span class="font-medium text-slate-900">{{ referenceNumber }}</span>
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
              Currency
            </div>
            <div class="mt-1 text-sm font-semibold text-slate-900">
              {{ summary.currency || 'Not specified' }}
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
              Invoice Amount
            </div>
            <div class="mt-1 text-sm font-semibold text-slate-900">
              {{ summary.invoiceAmount || 'Not specified' }}
            </div>
          </div>
        </div>
        <div class="space-y-4">
          <div>
            <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
              Beneficiary
            </div>
            <div class="mt-1 text-sm font-semibold text-slate-900">
              {{ summary.beneficiaryName || 'Not specified' }}
            </div>
            <div class="mt-1 text-xs text-slate-500">
              Country
              <span class="font-medium text-slate-900">
                {{ summary.beneficiaryCountry || 'Not specified' }}
              </span>
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
              Incoterms
            </div>
            <div class="mt-1 text-sm font-semibold text-slate-900">
              {{ summary.incoterms || 'Not specified' }}
            </div>
          </div>
          <div>
            <div class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
              Shipment Period
            </div>
            <div class="mt-1 text-sm font-semibold text-slate-900">
              {{ summary.expectedShipment || 'Not specified' }}
            </div>
          </div>
        </div>
      </div>

      <ng-template #emptySummary>
        <div
          class="flex items-center gap-3 rounded-lg border border-dashed border-slate-200 bg-slate-50 px-4 py-3 text-xs text-slate-600"
        >
          <div
            class="flex h-7 w-7 items-center justify-center rounded-full bg-slate-100 text-slate-500"
            aria-hidden="true"
          >
            ‚Ñπ
          </div>
          <p>
            LC details are not yet available. They will appear here once the bank completes the
            verification.
          </p>
        </div>
      </ng-template>
    </div>

    <div
      class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
      aria-label="Submitted trade summary"
    >
      <h2 class="text-sm font-semibold text-slate-900">Submitted Trade Summary</h2>
      <div class="mt-4 space-y-3 text-xs">
        <div class="flex items-center justify-between gap-4">
          <span class="text-slate-500">Trade Type</span>
          <span class="font-semibold text-slate-900">Import Letter of Credit</span>
        </div>
        <div class="flex items-center justify-between gap-4">
          <span class="text-slate-500">Amount</span>
          <span class="font-semibold text-slate-900">
            {{ summary.invoiceAmount || 'Not specified' }}
          </span>
        </div>
        <div class="flex items-center justify-between gap-4">
          <span class="text-slate-500">Currency</span>
          <span class="font-semibold text-slate-900">
            {{ summary.currency || 'Not specified' }}
          </span>
        </div>
        <div class="flex items-center justify-between gap-4">
          <span class="text-slate-500">Submission Date</span>
          <span class="font-semibold text-slate-900">{{ requestDateTime }}</span>
        </div>
      </div>
    </div>
  </section>

  <section
    class="mt-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
    aria-label="Uploaded commercial reference"
  >
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="flex h-8 w-8 items-center justify-center rounded-full bg-blue-50 text-blue-600">
          üìÑ
        </div>
        <div>
          <h2 class="text-sm font-semibold text-slate-900">Uploaded Commercial Reference</h2>
          <p class="text-xs text-slate-500">
            Reference documents provided as part of this Import LC request.
          </p>
        </div>
      </div>
    </div>

    <div
      class="mt-4 flex flex-col gap-3 rounded-xl border border-slate-200 bg-slate-50 p-4 text-xs text-slate-700 md:flex-row md:items-center md:justify-between"
      aria-label="Uploaded reference file"
    >
      <div class="flex items-start gap-3">
        <div
          class="mt-0.5 flex h-8 w-8 items-center justify-center rounded-lg bg-rose-100 text-[11px] font-semibold text-rose-700"
          aria-hidden="true"
        >
          PDF
        </div>
        <div>
          <div class="truncate text-sm font-semibold text-slate-900">
            {{ uploadedReference.fileName }}
          </div>
          <div class="mt-1 text-[11px] text-slate-500">
            Uploaded on
            <span class="font-medium text-slate-900">{{ uploadedReference.uploadedAt }}</span>
          </div>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-2 md:justify-end">
        <app-ui-button
          variant="secondary"
          class="min-w-[120px] justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
          (click)="viewFile()"
        >
          View
        </app-ui-button>
        <app-ui-button
          variant="secondary"
          class="min-w-[120px] justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
          (click)="downloadFile()"
        >
          Download
        </app-ui-button>
      </div>
    </div>
  </section>

  <section
    class="mt-4 rounded-2xl border border-emerald-100 bg-emerald-50 p-6 shadow-sm"
    aria-label="System acknowledgement"
  >
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div
          class="flex h-8 w-8 items-center justify-center rounded-full bg-emerald-100 text-emerald-700"
        >
          ‚úÖ
        </div>
        <div>
          <h2 class="text-sm font-semibold text-emerald-900">System Acknowledgement</h2>
          <p class="text-xs text-emerald-800">
            Your Import LC request has been successfully submitted and is under review.
          </p>
        </div>
      </div>
      <div class="text-[11px] text-emerald-800 md:text-right">
        <div>
          Reference:
          <span class="font-medium text-emerald-950">{{ referenceNumber }}</span>
        </div>
        <div>
          Processed:
          <span class="font-medium text-emerald-950">{{ requestDateTime }}</span>
        </div>
      </div>
    </div>
    <div class="mt-4 grid gap-3 md:grid-cols-3">
      <div
        *ngFor="let ack of acknowledgements"
        class="flex items-center gap-2 text-xs text-emerald-900"
      >
        <span
          class="flex h-6 w-6 items-center justify-center rounded-full bg-emerald-100 text-emerald-700"
        >
          ‚úì
        </span>
        <span>{{ ack }}</span>
      </div>
    </div>
  </section>

  <section
    class="mt-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
    aria-label="Available actions"
  >
    <h2 class="text-sm font-semibold text-slate-900">Available Actions</h2>
    <div class="mt-4 grid gap-3 md:grid-cols-4">
      <app-ui-button
        variant="primary"
        class="justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
        (click)="downloadFile()"
      >
        Download Draft LC
      </app-ui-button>
      <app-ui-button
        variant="secondary"
        class="justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
        (click)="viewSubmittedDetails()"
      >
        View Bank-Verified Details
      </app-ui-button>
      <app-ui-button
        variant="secondary"
        class="justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
        (click)="contactRO()"
      >
        Contact Relationship Officer
      </app-ui-button>
      <app-ui-button
        variant="secondary"
        class="justify-center transition-all duration-150 ease-out hover:-translate-y-0.5"
        (click)="print()"
      >
        Print Status Report
      </app-ui-button>
    </div>
  </section>

  <section
    class="mt-4 rounded-2xl border border-blue-100 bg-blue-50 p-6 shadow-sm"
    aria-label="What happens next"
  >
    <div class="flex items-start gap-3">
      <div
        class="flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 text-blue-700"
      >
        ‚ùì
      </div>
      <div class="space-y-2">
        <h2 class="text-sm font-semibold text-blue-900">What Happens Next?</h2>
        <p class="text-xs text-blue-900">
          Your LC request is being reviewed by the bank. A draft Letter of Credit will be prepared
          and made available for your review.
        </p>
        <p class="text-xs text-blue-900">
          Once the LC is approved and finalized, you will receive a notification and can download
          the official LC from this portal.
        </p>
        <p class="text-xs text-blue-900">
          If you require any clarification, please contact your Relationship Officer using the
          actions above.
        </p>
      </div>
    </div>
  </section>
</app-trade-layout>
